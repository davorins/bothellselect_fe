"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const A=require("react"),C=require("../../contexts/form/form.cjs.js"),q=require("../../hooks/use-event-listener.cjs.js"),p=require("./ach.styles.cjs.js"),x=require("./ach.utils.cjs.js");function L(t){if(t&&t.__esModule)return t;const a=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const s in t)if(s!=="default"){const o=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(a,s,o.get?o:{enumerable:!0,get:()=>t[s]})}}return a.default=t,Object.freeze(a)}const e=L(A);function _({accountHolderName:t,redirectURI:a,transactionId:s,callbacks:o,buttonProps:j,children:y,svgProps:R}){const[i,k]=e.useState(()=>{}),[z,w]=e.useState(!1),{cardTokenizeResponseReceived:b,createPaymentRequest:c,payments:E}=C.useForm(),d=e.useRef(null),O=async r=>{if(r.stopPropagation(),!i){console.warn("ACH button was clicked, but no ACH instance was found.");return}if(!c)throw new Error("`createPaymentRequest()` is required when using ACH payments");w(!0);try{const n=await i.tokenize({accountHolderName:t,intent:"CHARGE",amount:c.total.amount,currency:c.currencyCode});if(n?.status==="OK")return await b(n);let u=`Tokenization failed with status: ${n?.status??""}`;if(n?.errors)throw u+=` and errors: ${JSON.stringify(n?.errors)}`,new Error(u);console.warn(u)}catch(n){console.error(n)}finally{w(!1)}};if(e.useEffect(()=>{const r=new AbortController,{signal:n}=r;return(async m=>{const h=await E?.ach({redirectURI:a,transactionId:s}).then(f=>{if(!m?.aborted)return k(f),f});m.aborted?(h?.removeEventListener("ontokenization",()=>{}),await h?.destroy()):h?.addEventListener("ontokenization",async f=>{const{tokenResult:g,error:S}=f.detail;S||g?.status=="OK"&&await b(g)})})(n),()=>{r.abort()}},[c,E]),o)for(const r of Object.keys(o))i?.addEventListener(x.transformPlaidEventName(r),o[r]);q.useEventListener({listener:O,type:"click",element:d,options:{passive:!0}});const{isLoading:P,...v}=j??{},l=P||!i||z;return y?e.createElement(p.PayButton,{...v,"aria-disabled":l,disabled:l,ref:d,type:"button"},y):e.createElement(p.PayButton,{...v,"aria-disabled":l,disabled:l,ref:d,type:"button"},e.createElement(p.SvgIcon,{fill:"none",height:"1em",viewBox:"0 0 36 24",width:"1em",xmlns:"http://www.w3.org/2000/svg",...R},e.createElement("rect",{fill:"url(#prefix__paint0_linear)",height:24,rx:4,width:36}),e.createElement("path",{clipRule:"evenodd",d:"M18.509 6.16a.89.89 0 00-1.018 0l-6.124 4.285a.848.848 0 00-.325.96.873.873 0 00.833.595h1.75v4.286h-1.75a.866.866 0 00-.875.857c0 .473.392.857.875.857h12.25a.866.866 0 00.875-.857.866.866 0 00-.875-.857h-1.75V12h1.75c.38 0 .717-.24.833-.596a.848.848 0 00-.324-.959L18.509 6.16zm2.116 10.126V12h-5.25v4.286h5.25zM18 7.91l3.395 2.376h-6.79L18 7.91z",fill:"#fff",fillRule:"evenodd"}),e.createElement("defs",null,e.createElement("linearGradient",{gradientUnits:"userSpaceOnUse",id:"prefix__paint0_linear",x1:36,x2:0,y1:12,y2:12},e.createElement("stop",{stopColor:"#01D09E"}),e.createElement("stop",{offset:1,stopColor:"#03E4AE"})))),e.createElement("span",null,"Pay with Direct debit (ACH)"))}exports.Ach=_;exports.default=_;
//# sourceMappingURL=ach.cjs.js.map
