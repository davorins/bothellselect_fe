{"ast":null,"code":"import * as o from \"react\";\nimport { useForm as P } from \"../../contexts/form/form.es.mjs\";\nimport { useEventListener as h } from \"../../hooks/use-event-listener.es.mjs\";\nimport { ApplePayContainer as b } from \"./apple-pay.styles.es.mjs\";\nfunction v({\n  id: y = \"rswps-apple-pay\",\n  ...f\n}) {\n  const [t, d] = o.useState(() => {}),\n    {\n      cardTokenizeResponseReceived: w,\n      createPaymentRequest: a,\n      payments: s\n    } = P(),\n    l = o.useRef(null),\n    m = async r => {\n      if (r.stopPropagation(), !t) {\n        console.warn(\"Apple Pay button was clicked, but no Apple Pay instance was found.\");\n        return;\n      }\n      try {\n        const e = await t.tokenize();\n        if (e.status === \"OK\") return w(e);\n        let n = `Tokenization failed with status: ${e.status}`;\n        if (e?.errors) throw n += ` and errors: ${JSON.stringify(e?.errors)}`, new Error(n);\n        console.warn(n);\n      } catch (e) {\n        console.error(e);\n      }\n    };\n  return o.useEffect(() => {\n    if (!a) throw new Error(\"`createPaymentRequest()` is required when using digital wallets\");\n    const r = new AbortController(),\n      {\n        signal: e\n      } = r;\n    return (async p => {\n      const c = s?.paymentRequest(a);\n      if (!c) throw new Error(\"`paymentRequest` is required when using digital wallets\");\n      try {\n        const i = await s?.applePay(c).then(u => {\n          if (!p?.aborted) return d(u), u;\n        });\n        p.aborted && (await i?.destroy());\n      } catch (i) {\n        console.error(\"Initializing Apple Pay failed\", i);\n      }\n    })(e), () => {\n      r.abort();\n    };\n  }, [a, s]), h({\n    listener: m,\n    type: \"click\",\n    element: l,\n    options: {\n      passive: !0\n    }\n  }), /* @__PURE__ */o.createElement(b, {\n    ...f,\n    css: {\n      display: t ? \"block\" : \"none\",\n      opacity: t ? 1 : 0.5,\n      pointerEvents: t ? \"auto\" : \"none\",\n      visibility: t ? \"visible\" : \"hidden\"\n    },\n    id: y,\n    ref: l\n  });\n}\nexport { v as default };","map":{"version":3,"names":["v","id","y","f","t","d","o","useState","cardTokenizeResponseReceived","w","createPaymentRequest","a","payments","s","P","l","useRef","m","r","stopPropagation","console","warn","e","tokenize","status","n","errors","JSON","stringify","Error","error","useEffect","AbortController","signal","p","c","paymentRequest","i","applePay","then","u","aborted","destroy","abort","h","listener","type","element","options","passive","createElement","b","css","display","opacity","pointerEvents","visibility","ref"],"sources":["/Users/davorins/Desktop/bs/node_modules/react-square-web-payments-sdk/src/components/apple-pay/apple-pay.tsx"],"sourcesContent":["// Dependencies\nimport * as React from 'react';\nimport type * as Square from '@square/web-sdk';\n\n// Internals\nimport { useForm } from '~/contexts/form';\nimport { useEventListener } from '~/hooks/use-event-listener';\nimport { ApplePayContainer } from './apple-pay.styles';\nimport type { ApplePayProps } from './apple-pay.types';\n\n/**\n * Renders a Apple Pay button to use in the Square Web Payment SDK, pre-styled\n * to meet Apple Pay's branding guidelines.\n *\n * **Remember** that you need to set `createPaymentRequest()` in `SquareForm` if\n * you going to use this Payment Method\n *\n * @example\n *\n * ```tsx\n * function App() {\n *   return (\n *     <SquareForm {...props}>\n *       <ApplePay />\n *     </SquareForm>\n *   );\n * }\n * ```\n */\nfunction ApplePay({ id = 'rswps-apple-pay', ...props }: ApplePayProps) {\n  const [applePay, setApplePay] = React.useState<Square.ApplePay | undefined>(() => undefined);\n  const { cardTokenizeResponseReceived, createPaymentRequest, payments } = useForm();\n  const containerRef = React.useRef<HTMLDivElement>(null);\n\n  /**\n   * Handle the on click of the Apple Pay button click\n   *\n   * @param e An event which takes place in the DOM.\n   * @returns The data be sended to `cardTokenizeResponseReceived()` function, or an error\n   */\n  const handlePayment = async (e: Event) => {\n    e.stopPropagation();\n\n    if (!applePay) {\n      console.warn('Apple Pay button was clicked, but no Apple Pay instance was found.');\n\n      return;\n    }\n\n    try {\n      const result = await applePay.tokenize();\n\n      if (result.status === 'OK') {\n        return cardTokenizeResponseReceived(result);\n      }\n\n      let message = `Tokenization failed with status: ${result.status}`;\n      if (result?.errors) {\n        message += ` and errors: ${JSON.stringify(result?.errors)}`;\n\n        throw new Error(message);\n      }\n\n      console.warn(message);\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  React.useEffect(() => {\n    if (!createPaymentRequest) {\n      throw new Error('`createPaymentRequest()` is required when using digital wallets');\n    }\n\n    const abortController = new AbortController();\n    const { signal } = abortController;\n\n    const start = async (signal: AbortSignal) => {\n      const paymentRequest = payments?.paymentRequest(createPaymentRequest);\n\n      if (!paymentRequest) {\n        throw new Error('`paymentRequest` is required when using digital wallets');\n      }\n\n      try {\n        const applePay = await payments?.applePay(paymentRequest).then((res) => {\n          if (signal?.aborted) {\n            return;\n          }\n\n          setApplePay(res);\n\n          return res;\n        });\n\n        if (signal.aborted) {\n          await applePay?.destroy();\n        }\n      } catch (error) {\n        console.error('Initializing Apple Pay failed', error);\n      }\n    };\n\n    start(signal);\n\n    return () => {\n      abortController.abort();\n    };\n  }, [createPaymentRequest, payments]);\n\n  useEventListener({\n    listener: handlePayment,\n    type: 'click',\n    element: containerRef,\n    options: {\n      passive: true,\n    },\n  });\n\n  return (\n    <ApplePayContainer\n      {...props}\n      // We need to make this styles to be able to use event listener\n      css={{\n        display: applePay ? 'block' : 'none',\n        opacity: applePay ? 1 : 0.5,\n        pointerEvents: applePay ? 'auto' : 'none',\n        visibility: applePay ? 'visible' : 'hidden',\n      }}\n      id={id}\n      ref={containerRef}\n    ></ApplePayContainer>\n  );\n}\n\nexport default ApplePay;\nexport * from './apple-pay.types';\n"],"mappings":";;;;AA6BA,SAASA,EAAS;EAAEC,EAAA,EAAAC,CAAA,GAAK;EAAA,GAAsBC;AAAA,GAAwB;EACrE,MAAM,CAACC,CAAA,EAAUC,CAAW,IAAIC,CAAA,CAAMC,QAAA,CAAsC,QAAe;IACrF;MAAEC,4BAAA,EAAAC,CAAA;MAA8BC,oBAAA,EAAAC,CAAA;MAAsBC,QAAA,EAAAC;IAAA,IAAaC,CAAA,CAAQ;IAC3EC,CAAA,GAAeT,CAAA,CAAMU,MAAA,CAAuB,IAAI;IAQhDC,CAAA,GAAgB,MAAOC,CAAA,IAAa;MAGxC,IAFAA,CAAA,CAAEC,eAAA,CAAgB,GAEd,CAACf,CAAA,EAAU;QACbgB,OAAA,CAAQC,IAAA,CAAK,oEAAoE;QAEjF;MACF;MAEI;QACI,MAAAC,CAAA,GAAS,MAAMlB,CAAA,CAASmB,QAAA;QAE1B,IAAAD,CAAA,CAAOE,MAAA,KAAW,MACpB,OAAOf,CAAA,CAA6Ba,CAAM;QAGxC,IAAAG,CAAA,GAAU,oCAAoCH,CAAA,CAAOE,MAAA;QACzD,IAAIF,CAAA,EAAQI,MAAA,EACV,MAAAD,CAAA,IAAW,gBAAgBE,IAAA,CAAKC,SAAA,CAAUN,CAAA,EAAQI,MAAM,KAElD,IAAIG,KAAA,CAAMJ,CAAO;QAGzBL,OAAA,CAAQC,IAAA,CAAKI,CAAO;MAAA,SACbH,CAAA;QACPF,OAAA,CAAQU,KAAA,CAAMR,CAAK;MACrB;IAAA;EAGF,OAAAhB,CAAA,CAAMyB,SAAA,CAAU,MAAM;IACpB,IAAI,CAACpB,CAAA,EACG,UAAIkB,KAAA,CAAM,iEAAiE;IAG7E,MAAAX,CAAA,GAAkB,IAAIc,eAAA;MACtB;QAAEC,MAAA,EAAAX;MAAW,IAAAJ,CAAA;IA4BnB,QA1Bc,MAAOgB,CAAA,IAAwB;MACrC,MAAAC,CAAA,GAAiBtB,CAAA,EAAUuB,cAAA,CAAezB,CAAoB;MAEpE,IAAI,CAACwB,CAAA,EACG,UAAIN,KAAA,CAAM,yDAAyD;MAGvE;QACI,MAAAQ,CAAA,GAAW,MAAMxB,CAAA,EAAUyB,QAAA,CAASH,CAAc,EAAEI,IAAA,CAAMC,CAAA,IAAQ;UACtE,IAAI,CAAAN,CAAA,EAAQO,OAAA,EAIZ,OAAApC,CAAA,CAAYmC,CAAG,GAERA,CAAA;QAAA,CACR;QAEGN,CAAA,CAAOO,OAAA,KACT,MAAMJ,CAAA,EAAUK,OAAA;eAEXL,CAAA;QACCjB,OAAA,CAAAU,KAAA,CAAM,iCAAiCO,CAAK;MACtD;IAAA,GAGIf,CAAM,GAEL,MAAM;MACXJ,CAAA,CAAgByB,KAAA,CAAM;IAAA;EACxB,GACC,CAAChC,CAAA,EAAsBE,CAAQ,CAAC,GAElB+B,CAAA;IACfC,QAAA,EAAU5B,CAAA;IACV6B,IAAA,EAAM;IACNC,OAAA,EAAShC,CAAA;IACTiC,OAAA,EAAS;MACPC,OAAA,EAAS;IACX;EAAA,CACD,GAGE,eAAA3C,CAAA,CAAA4C,aAAA,CAAAC,CAAA;IACE,GAAGhD,CAAA;IAEJiD,GAAA,EAAK;MACHC,OAAA,EAASjD,CAAA,GAAW,UAAU;MAC9BkD,OAAA,EAASlD,CAAA,GAAW,IAAI;MACxBmD,aAAA,EAAenD,CAAA,GAAW,SAAS;MACnCoD,UAAA,EAAYpD,CAAA,GAAW,YAAY;IACrC;IACAH,EAAA,EAAAC,CAAA;IACAuD,GAAA,EAAK1C;EAAA,CACN;AAEL","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}