{"ast":null,"code":"import * as r from \"react\";\nimport { useForm as P } from \"../../contexts/form/form.es.mjs\";\nimport { useEventListener as L } from \"../../hooks/use-event-listener.es.mjs\";\nimport { LoadingCard as $, PayButton as j } from \"./credit-card.styles.es.mjs\";\nfunction x({\n  buttonProps: u,\n  callbacks: c,\n  children: h,\n  focus: s,\n  id: d = \"rswps-card-container\",\n  includeInputLabels: l,\n  postalCode: f,\n  recalculateSize: m,\n  render: w,\n  style: b,\n  ...v\n}) {\n  const [a, R] = r.useState(() => {}),\n    [k, p] = r.useState(!1),\n    y = r.useRef(null),\n    {\n      cardTokenizeResponseReceived: z,\n      payments: E\n    } = P(),\n    O = r.useMemo(() => {\n      const e = {\n        includeInputLabels: l,\n        postalCode: f,\n        style: b\n      };\n      return Object.keys(e).reduce((t, n) => (e[n] !== void 0 && (t[n] = e[n]), t), {});\n    }, [l, f, b]),\n    S = async e => {\n      if (e.stopPropagation(), !u?.isLoading) {\n        if (!a) {\n          console.warn(\"Credit Card button was clicked, but no Credit Card instance was found.\");\n          return;\n        }\n        p(!0);\n        try {\n          const t = await a.tokenize();\n          if (t.status === \"OK\") return await z(t);\n          let n = `Tokenization failed with status: ${t.status}`;\n          if (t?.errors) throw n += ` and errors: ${JSON.stringify(t?.errors)}`, new Error(n);\n          console.warn(n);\n        } catch (t) {\n          console.error(t);\n        } finally {\n          p(!1);\n        }\n      }\n    };\n  if (r.useEffect(() => {\n    const e = new AbortController(),\n      {\n        signal: t\n      } = e;\n    return (async i => {\n      const o = await E?.card(O).then(C => i.aborted ? null : (R(C), C));\n      await o?.attach(`#${d}`), s && (await o?.focus(s)), i.aborted && (await o?.destroy());\n    })(t), () => {\n      e.abort();\n    };\n  }, [E, d]), r.useEffect(() => {\n    a && s && a.focus(s);\n  }, [a, s]), c) for (const e of Object.keys(c)) a?.addEventListener(e, c[e]);\n  m && m(a?.recalculateSize), L({\n    listener: S,\n    type: \"click\",\n    element: y,\n    options: {\n      passive: !0\n    }\n  });\n  const g = ({\n    children: e,\n    isLoading: t,\n    ...n\n  }) => {\n    const i = \"rswp-card-button\",\n      o = t || !a || k;\n    return /* @__PURE__ */r.createElement(j, {\n      ...n,\n      \"aria-disabled\": o,\n      css: n?.css,\n      disabled: o,\n      id: i,\n      ref: y,\n      type: \"button\"\n    }, e ?? \"Pay\");\n  };\n  return /* @__PURE__ */r.createElement(r.Fragment, null, /* @__PURE__ */r.createElement(\"div\", {\n    ...v,\n    \"data-testid\": \"rswps-card-container\",\n    id: d,\n    style: {\n      minHeight: 89\n    }\n  }, !a && /* @__PURE__ */r.createElement($, null)), typeof w == \"function\" ? w(g) : /* @__PURE__ */r.createElement(g, {\n    ...u\n  }, h ?? \"Pay\"));\n}\nexport { x as default };","map":{"version":3,"names":["x","buttonProps","u","callbacks","c","children","h","focus","s","id","d","includeInputLabels","l","postalCode","f","recalculateSize","m","render","w","style","b","v","a","R","r","useState","k","p","y","useRef","cardTokenizeResponseReceived","z","payments","E","P","O","useMemo","e","Object","keys","reduce","t","n","S","stopPropagation","isLoading","console","warn","tokenize","status","errors","JSON","stringify","Error","error","useEffect","AbortController","signal","i","o","card","then","C","aborted","attach","destroy","abort","addEventListener","L","listener","type","element","options","passive","g","Button","createElement","j","css","disabled","ref","Fragment","minHeight","$"],"sources":["/Users/davorins/Desktop/bs/node_modules/react-square-web-payments-sdk/src/components/credit-card/credit-card.tsx"],"sourcesContent":["// Dependencies\nimport * as React from 'react';\nimport type * as Square from '@square/web-sdk';\n\n// Internals\nimport { useForm } from '~/contexts/form';\nimport { useEventListener } from '~/hooks/use-event-listener';\nimport { LoadingCard, PayButton } from './credit-card.styles';\nimport type {\n  CreditCardBase,\n  CreditCardChildren,\n  CreditCardFunctionChildren,\n  CreditCardPayButtonProps,\n  CreditCardProps,\n} from './credit-card.types';\n\n/**\n * Renders a Credit Card Input to use in the Square Web Payment SDK, pre-styled\n * to meet Square branding guidelines.\n *\n * **_But with the option to override styles_**\n *\n * @example\n *\n * ```tsx\n * function App() {\n *   return (\n *     <SquareForm {...props}>\n *       <CreditCard />\n *     </SquareForm>\n *   );\n * }\n * ```\n */\nfunction CreditCard(props: CreditCardBase): JSX.Element;\nfunction CreditCard(props: CreditCardChildren): JSX.Element;\nfunction CreditCard(props: CreditCardFunctionChildren): JSX.Element;\nfunction CreditCard({\n  buttonProps,\n  callbacks,\n  children,\n  focus,\n  id = 'rswps-card-container',\n  includeInputLabels,\n  postalCode,\n  recalculateSize,\n  render,\n  style,\n  ...props\n}: CreditCardProps) {\n  const [card, setCard] = React.useState<Square.Card | undefined>(() => undefined);\n  const [isSubmitting, setIsSubmitting] = React.useState<boolean>(false);\n  const buttonRef = React.useRef<HTMLButtonElement>(null);\n  const { cardTokenizeResponseReceived, payments } = useForm();\n\n  const options: Square.CardOptions = React.useMemo(() => {\n    const baseOptions = {\n      includeInputLabels,\n      postalCode,\n      style,\n    };\n\n    // if a value from options is undefined delete it from the options object\n    return Object.keys(baseOptions).reduce((acc: Record<string, unknown>, key) => {\n      if (baseOptions[key as keyof typeof baseOptions] !== undefined) {\n        acc[key as string] = baseOptions[key as keyof typeof baseOptions];\n      }\n\n      return acc;\n    }, {});\n  }, [includeInputLabels, postalCode, style]);\n\n  /**\n   * Handle the on click of the Credit Card button click\n   *\n   * @param e An event which takes place in the DOM.\n   * @returns The data be sended to `cardTokenizeResponseReceived()` function, or an error\n   */\n  const handlePayment = async (e: Event) => {\n    e.stopPropagation();\n\n    if (buttonProps?.isLoading) return;\n\n    if (!card) {\n      console.warn('Credit Card button was clicked, but no Credit Card instance was found.');\n\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      const result = await card.tokenize();\n\n      if (result.status === 'OK') {\n        const tokenizedResult = await cardTokenizeResponseReceived(result);\n        return tokenizedResult;\n      }\n\n      let message = `Tokenization failed with status: ${result.status}`;\n      if (result?.errors) {\n        message += ` and errors: ${JSON.stringify(result?.errors)}`;\n\n        throw new Error(message);\n      }\n\n      console.warn(message);\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  React.useEffect(() => {\n    const abortController = new AbortController();\n    const { signal } = abortController;\n\n    const start = async (signal: AbortSignal) => {\n      const card = await payments?.card(options).then((res) => {\n        if (!signal.aborted) {\n          setCard(res);\n          return res;\n        }\n\n        return null;\n      });\n\n      await card?.attach(`#${id}`);\n      if (focus) {\n        await card?.focus(focus);\n      }\n\n      if (signal.aborted) {\n        await card?.destroy();\n      }\n    };\n\n    start(signal);\n\n    return () => {\n      abortController.abort();\n    };\n  }, [payments, id]);\n\n  React.useEffect(() => {\n    if (card && focus) {\n      card.focus(focus);\n    }\n  }, [card, focus]);\n\n  if (callbacks) {\n    for (const callback of Object.keys(callbacks)) {\n      card?.addEventListener(\n        callback as Square.CardInputEventTypes,\n        (callbacks as Record<string, (event: Square.SqEvent<Square.CardInputEvent>) => void>)[callback]\n      );\n    }\n  }\n\n  if (recalculateSize) {\n    recalculateSize(card?.recalculateSize);\n  }\n\n  useEventListener({\n    listener: handlePayment,\n    type: 'click',\n    element: buttonRef,\n    options: {\n      passive: true,\n    },\n  });\n\n  const Button = ({ children, isLoading, ...props }: CreditCardPayButtonProps) => {\n    const id = 'rswp-card-button';\n    const disabled = isLoading || !card || isSubmitting;\n\n    return (\n      <PayButton\n        {...props}\n        aria-disabled={disabled}\n        css={props?.css}\n        disabled={disabled}\n        id={id}\n        ref={buttonRef}\n        type=\"button\"\n      >\n        {children ?? 'Pay'}\n      </PayButton>\n    );\n  };\n\n  return (\n    <>\n      <div {...props} data-testid=\"rswps-card-container\" id={id} style={{ minHeight: 89 }}>\n        {!card && <LoadingCard />}\n      </div>\n\n      {typeof render === 'function' ? render(Button) : <Button {...buttonProps}>{children ?? 'Pay'}</Button>}\n    </>\n  );\n}\n\nexport default CreditCard;\nexport * from './credit-card.types';\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}