{"ast":null,"code":"import * as r from \"react\";\nimport { useForm as z } from \"../../contexts/form/form.es.mjs\";\nimport { useEventListener as O } from \"../../hooks/use-event-listener.es.mjs\";\nimport { LoadingCard as P, PayButton as S } from \"./gift-card.styles.es.mjs\";\nfunction F({\n  buttonProps: y = {\n    id: \"rswps-gift-card-button\"\n  },\n  callbacks: s,\n  children: C,\n  focus: f,\n  id: i = \"rswps-gift-card-container\",\n  includeInputLabels: u,\n  render: d,\n  style: l,\n  ...h\n}) {\n  const [a, E] = r.useState(() => {}),\n    [v, m] = r.useState(!1),\n    {\n      cardTokenizeResponseReceived: R,\n      payments: w\n    } = z(),\n    b = r.useRef(null),\n    k = r.useMemo(() => {\n      const e = {\n        includeInputLabels: u,\n        style: l\n      };\n      return Object.keys(e).reduce((t, n) => (e[n] !== void 0 && (t[n] = e[n]), t), {});\n    }, [u, l]),\n    G = async e => {\n      if (e.stopPropagation(), !a) {\n        console.warn(\"Gift Card button was clicked, but no Gift Card instance was found.\");\n        return;\n      }\n      m(!0);\n      try {\n        const t = await a?.tokenize();\n        if (t.status === \"OK\") return await R(t);\n        let n = `Tokenization failed with status: ${t.status}`;\n        if (t?.errors) throw n += ` and errors: ${JSON.stringify(t?.errors)}`, new Error(n);\n        console.warn(n);\n      } catch (t) {\n        console.error(t);\n      } finally {\n        m(!1);\n      }\n    };\n  if (r.useEffect(() => {\n    const e = new AbortController(),\n      {\n        signal: t\n      } = e;\n    return (async o => {\n      const c = await w?.giftCard(k).then(p => o.aborted ? null : (E(p), p));\n      await c?.attach(`#${i}`), f && (await c?.focus(f)), o.aborted && (await c?.destroy());\n    })(t), () => {\n      e.abort();\n    };\n  }, [w, i]), s) for (const e of Object.keys(s)) a?.addEventListener(e, s[e]);\n  O({\n    listener: G,\n    type: \"click\",\n    element: b,\n    options: {\n      passive: !0\n    }\n  });\n  const g = ({\n    isLoading: e,\n    ...t\n  }) => {\n    const n = \"rswp-gift-card-button\",\n      o = e || !a || v;\n    return /* @__PURE__ */r.createElement(S, {\n      ...t,\n      \"aria-disabled\": o,\n      css: t?.css,\n      disabled: o,\n      id: n,\n      ref: b,\n      type: \"button\"\n    }, t?.children ?? \"Pay with Gift Card\");\n  };\n  return /* @__PURE__ */r.createElement(r.Fragment, null, /* @__PURE__ */r.createElement(\"div\", {\n    ...h,\n    \"data-testid\": \"rswps-gift-card-container\",\n    id: i,\n    style: {\n      minHeight: 89\n    }\n  }, !a && /* @__PURE__ */r.createElement(P, null)), typeof d == \"function\" ? d(g) : /* @__PURE__ */r.createElement(g, {\n    ...y\n  }, C ?? \"Pay with Gift Card\"));\n}\nexport { F as default };","map":{"version":3,"names":["F","buttonProps","y","id","callbacks","s","children","C","focus","f","i","includeInputLabels","u","render","d","style","l","h","a","E","r","useState","v","m","cardTokenizeResponseReceived","R","payments","w","z","b","useRef","k","useMemo","e","Object","keys","reduce","t","n","G","stopPropagation","console","warn","tokenize","status","errors","JSON","stringify","Error","error","useEffect","AbortController","signal","o","c","giftCard","then","p","aborted","attach","destroy","abort","addEventListener","O","listener","type","element","options","passive","g","Button","isLoading","createElement","S","css","disabled","ref","Fragment","minHeight","P"],"sources":["/Users/davorins/Desktop/bs/node_modules/react-square-web-payments-sdk/src/components/gift-card/gift-card.tsx"],"sourcesContent":["// Dependencies\nimport * as React from 'react';\nimport type * as Square from '@square/web-sdk';\n\n// Internals\nimport { useForm } from '~/contexts/form';\nimport { useEventListener } from '~/hooks/use-event-listener';\nimport { LoadingCard, PayButton } from './gift-card.styles';\nimport type {\n  GiftCardBase,\n  GiftCardFunctionChildren,\n  GiftCardPayButtonProps,\n  GiftCardProps,\n  GiftCardWithChildren,\n} from './gift-card.types';\n\n/**\n * Renders a Gift Card Input to use in the Square Web Payment SDK, pre-styled to\n * meet Square branding guidelines.\n *\n * **_But with the option to override styles_**\n *\n * @example\n *\n * ```tsx\n * function App() {\n *   return (\n *     <SquareForm {...props}>\n *       <GiftCard />\n *     </SquareForm>\n *   );\n * }\n * ```\n */\nfunction GiftCard(props: GiftCardBase): JSX.Element;\nfunction GiftCard(props: GiftCardFunctionChildren): JSX.Element;\nfunction GiftCard(props: GiftCardWithChildren): JSX.Element;\nfunction GiftCard({\n  buttonProps = {\n    id: 'rswps-gift-card-button',\n  },\n  callbacks,\n  children,\n  focus,\n  id = 'rswps-gift-card-container',\n  includeInputLabels,\n  render,\n  style,\n  ...props\n}: GiftCardProps) {\n  const [giftCard, setGiftCard] = React.useState<Square.GiftCard | undefined>(() => undefined);\n  const [isSubmitting, setIsSubmitting] = React.useState<boolean>(false);\n  const { cardTokenizeResponseReceived, payments } = useForm();\n  const buttonRef = React.useRef<HTMLButtonElement>(null);\n\n  const options: Square.GiftCardOptions = React.useMemo(() => {\n    const baseOptions = {\n      includeInputLabels,\n      style,\n    };\n\n    // if a value from options is undefined delete it from the options object\n    return Object.keys(baseOptions).reduce((acc: Record<string, unknown>, key) => {\n      if (baseOptions[key as keyof typeof baseOptions] !== undefined) {\n        acc[key as string] = baseOptions[key as keyof typeof baseOptions];\n      }\n\n      return acc;\n    }, {});\n  }, [includeInputLabels, style]);\n\n  /** Tokenizes a GiftCard payment method instance. */\n  const handlePayment = async (e: Event) => {\n    e.stopPropagation();\n\n    if (!giftCard) {\n      console.warn('Gift Card button was clicked, but no Gift Card instance was found.');\n\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      const result = await giftCard?.tokenize();\n\n      if (result.status === 'OK') {\n        const tokenizedResult = await cardTokenizeResponseReceived(result);\n        return tokenizedResult;\n      }\n\n      let message = `Tokenization failed with status: ${result.status}`;\n      if (result?.errors) {\n        message += ` and errors: ${JSON.stringify(result?.errors)}`;\n\n        throw new Error(message);\n      }\n\n      console.warn(message);\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  React.useEffect(() => {\n    const abortController = new AbortController();\n    const { signal } = abortController;\n\n    const start = async (signal: AbortSignal) => {\n      const giftCard = await payments?.giftCard(options).then((res) => {\n        if (!signal.aborted) {\n          setGiftCard(res);\n\n          return res;\n        }\n\n        return null;\n      });\n\n      await giftCard?.attach(`#${id}`);\n      if (focus) {\n        await giftCard?.focus(focus);\n      }\n\n      if (signal.aborted) {\n        await giftCard?.destroy();\n      }\n    };\n\n    start(signal);\n\n    return () => {\n      abortController.abort();\n    };\n  }, [payments, id]);\n\n  if (callbacks) {\n    for (const callback of Object.keys(callbacks)) {\n      giftCard?.addEventListener(\n        callback as Square.GiftCardInputEventTypes,\n        (callbacks as Record<string, (event: Square.SqEvent<Square.GiftCardInputEvent>) => void>)[callback]\n      );\n    }\n  }\n\n  useEventListener({\n    listener: handlePayment,\n    type: 'click',\n    element: buttonRef,\n    options: {\n      passive: true,\n    },\n  });\n\n  const Button = ({ isLoading, ...props }: GiftCardPayButtonProps) => {\n    const id = 'rswp-gift-card-button';\n    const disabled = isLoading || !giftCard || isSubmitting;\n\n    return (\n      <PayButton\n        {...props}\n        aria-disabled={disabled}\n        css={props?.css}\n        disabled={disabled}\n        id={id}\n        ref={buttonRef}\n        type=\"button\"\n      >\n        {props?.children ?? 'Pay with Gift Card'}\n      </PayButton>\n    );\n  };\n\n  return (\n    <>\n      <div {...props} data-testid=\"rswps-gift-card-container\" id={id} style={{ minHeight: 89 }}>\n        {!giftCard && <LoadingCard />}\n      </div>\n\n      {typeof render === 'function' ? (\n        render(Button)\n      ) : (\n        <Button {...buttonProps}>{children ?? 'Pay with Gift Card'}</Button>\n      )}\n    </>\n  );\n}\n\nexport default GiftCard;\nexport * from './gift-card.types';\n"],"mappings":";;;;AAqCA,SAASA,EAAS;EAChBC,WAAA,EAAAC,CAAA,GAAc;IACZC,EAAA,EAAI;EACN;EACAC,SAAA,EAAAC,CAAA;EACAC,QAAA,EAAAC,CAAA;EACAC,KAAA,EAAAC,CAAA;EACAN,EAAA,EAAAO,CAAA,GAAK;EACLC,kBAAA,EAAAC,CAAA;EACAC,MAAA,EAAAC,CAAA;EACAC,KAAA,EAAAC,CAAA;EAAA,GACGC;AACL,GAAkB;EAChB,MAAM,CAACC,CAAA,EAAUC,CAAW,IAAIC,CAAA,CAAMC,QAAA,CAAsC,QAAe;IACrF,CAACC,CAAA,EAAcC,CAAe,IAAIH,CAAA,CAAMC,QAAA,CAAkB,EAAK;IAC/D;MAAEG,4BAAA,EAAAC,CAAA;MAA8BC,QAAA,EAAAC;IAAS,IAAIC,CAAA,CAAQ;IACrDC,CAAA,GAAYT,CAAA,CAAMU,MAAA,CAA0B,IAAI;IAEhDC,CAAA,GAAkCX,CAAA,CAAMY,OAAA,CAAQ,MAAM;MAC1D,MAAMC,CAAA,GAAc;QAClBtB,kBAAA,EAAAC,CAAA;QACAG,KAAA,EAAAC;MAAA;MAIF,OAAOkB,MAAA,CAAOC,IAAA,CAAKF,CAAW,EAAEG,MAAA,CAAO,CAACC,CAAA,EAA8BC,CAAA,MAChEL,CAAA,CAAYK,CAAA,MAAqC,WACnDD,CAAA,CAAIC,CAAA,IAAiBL,CAAA,CAAYK,CAAA,IAG5BD,CAAA,GACN,CAAE;IAAA,GACJ,CAACzB,CAAA,EAAoBI,CAAK,CAAC;IAGxBuB,CAAA,GAAgB,MAAON,CAAA,IAAa;MAGxC,IAFAA,CAAA,CAAEO,eAAA,CAAgB,GAEd,CAACtB,CAAA,EAAU;QACbuB,OAAA,CAAQC,IAAA,CAAK,oEAAoE;QAEjF;MACF;MAEAnB,CAAA,CAAgB,EAAI;MAEhB;QACI,MAAAc,CAAA,GAAS,MAAMnB,CAAA,EAAUyB,QAAA;QAE3B,IAAAN,CAAA,CAAOO,MAAA,KAAW,MAEb,OADiB,MAAMnB,CAAA,CAA6BY,CAAM;QAI/D,IAAAC,CAAA,GAAU,oCAAoCD,CAAA,CAAOO,MAAA;QACzD,IAAIP,CAAA,EAAQQ,MAAA,EACV,MAAAP,CAAA,IAAW,gBAAgBQ,IAAA,CAAKC,SAAA,CAAUV,CAAA,EAAQQ,MAAM,KAElD,IAAIG,KAAA,CAAMV,CAAO;QAGzBG,OAAA,CAAQC,IAAA,CAAKJ,CAAO;MAAA,SACbD,CAAA;QACPI,OAAA,CAAQQ,KAAA,CAAMZ,CAAK;MAAA,UACnB;QACAd,CAAA,CAAgB,EAAK;MACvB;IAAA;EAmCF,IAhCAH,CAAA,CAAM8B,SAAA,CAAU,MAAM;IACd,MAAAjB,CAAA,GAAkB,IAAIkB,eAAA;MACtB;QAAEC,MAAA,EAAAf;MAAW,IAAAJ,CAAA;IAuBnB,QArBc,MAAOoB,CAAA,IAAwB;MACrC,MAAAC,CAAA,GAAW,MAAM3B,CAAA,EAAU4B,QAAA,CAASxB,CAAO,EAAEyB,IAAA,CAAMC,CAAA,IAClDJ,CAAA,CAAOK,OAAA,GAML,QALLvC,CAAA,CAAYsC,CAAG,GAERA,CAAA,CAIV;MAEK,MAAAH,CAAA,EAAUK,MAAA,CAAO,IAAIjD,CAAA,EAAI,GAC3BD,CAAA,KACI,MAAA6C,CAAA,EAAU9C,KAAA,CAAMC,CAAK,IAGzB4C,CAAA,CAAOK,OAAA,KACT,MAAMJ,CAAA,EAAUM,OAAA;IAClB,GAGIvB,CAAM,GAEL,MAAM;MACXJ,CAAA,CAAgB4B,KAAA,CAAM;IAAA;EACxB,GACC,CAAClC,CAAA,EAAUjB,CAAE,CAAC,GAEbL,CAAA,EACF,WAAW4B,CAAA,IAAYC,MAAA,CAAOC,IAAA,CAAK9B,CAAS,GAChCa,CAAA,EAAA4C,gBAAA,CACR7B,CAAA,EACC5B,CAAA,CAAyF4B,CAAA;EAK/E8B,CAAA;IACfC,QAAA,EAAUzB,CAAA;IACV0B,IAAA,EAAM;IACNC,OAAA,EAASrC,CAAA;IACTsC,OAAA,EAAS;MACPC,OAAA,EAAS;IACX;EAAA,CACD;EAED,MAAMC,CAAA,GAASC,CAAC;IAAEC,SAAA,EAAAtC,CAAA;IAAA,GAAcI;EAAA,MAAoC;IAClE,MAAMC,CAAA,GAAK;MACLe,CAAA,GAAWpB,CAAA,IAAa,CAACf,CAAA,IAAYI,CAAA;IAE3C,OACG,eAAAF,CAAA,CAAAoD,aAAA,CAAAC,CAAA;MACE,GAAGpC,CAAA;MACJ,iBAAegB,CAAA;MACfqB,GAAA,EAAKrC,CAAA,EAAOqC,GAAA;MACZC,QAAA,EAAAtB,CAAA;MACAlD,EAAA,EAAImC,CAAA;MACJsC,GAAA,EAAK/C,CAAA;MACLoC,IAAA,EAAK;IAAA,GAEJ5B,CAAA,EAAO/B,QAAA,IAAY,oBACtB;EAAA;EAIJ,sBAAAc,CAAA,CAAAoD,aAAA,CAAApD,CAAA,CAAAyD,QAAA,QAEK,eAAAzD,CAAA,CAAAoD,aAAA;IAAK,GAAGvD,CAAA;IAAO,eAAY;IAA4Bd,EAAA,EAAAO,CAAA;IAAQK,KAAA,EAAO;MAAE+D,SAAA,EAAW;IAAG;EAAA,GACpF,CAAC5D,CAAA,IAAa,eAAAE,CAAA,CAAAoD,aAAA,CAAAO,CAAA,MAAY,CAC7B,GAEC,OAAOjE,CAAA,IAAW,aACjBA,CAAA,CAAOuD,CAAM,IAEZ,eAAAjD,CAAA,CAAAoD,aAAA,CAAAH,CAAA;IAAQ,GAAGnE;EAAA,GAAcK,CAAA,IAAY,oBAAqB,CAE/D;AAEJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}