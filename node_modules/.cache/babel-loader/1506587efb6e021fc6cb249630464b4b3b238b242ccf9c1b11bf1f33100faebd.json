{"ast":null,"code":"import * as e from \"react\";\nimport { useForm as P } from \"../../contexts/form/form.es.mjs\";\nimport { useEventListener as S } from \"../../hooks/use-event-listener.es.mjs\";\nimport { PayButton as E, SvgIcon as _ } from \"./ach.styles.es.mjs\";\nimport { transformPlaidEventName as H } from \"./ach.utils.es.mjs\";\nfunction G({\n  accountHolderName: b,\n  redirectURI: v,\n  transactionId: g,\n  callbacks: l,\n  buttonProps: R,\n  children: d,\n  svgProps: k\n}) {\n  const [r, z] = e.useState(() => {}),\n    [C, m] = e.useState(!1),\n    {\n      cardTokenizeResponseReceived: p,\n      createPaymentRequest: o,\n      payments: h\n    } = P(),\n    c = e.useRef(null),\n    A = async n => {\n      if (n.stopPropagation(), !r) {\n        console.warn(\"ACH button was clicked, but no ACH instance was found.\");\n        return;\n      }\n      if (!o) throw new Error(\"`createPaymentRequest()` is required when using ACH payments\");\n      m(!0);\n      try {\n        const t = await r.tokenize({\n          accountHolderName: b,\n          intent: \"CHARGE\",\n          amount: o.total.amount,\n          currency: o.currencyCode\n        });\n        if (t?.status === \"OK\") return await p(t);\n        let s = `Tokenization failed with status: ${t?.status ?? \"\"}`;\n        if (t?.errors) throw s += ` and errors: ${JSON.stringify(t?.errors)}`, new Error(s);\n        console.warn(s);\n      } catch (t) {\n        console.error(t);\n      } finally {\n        m(!1);\n      }\n    };\n  if (e.useEffect(() => {\n    const n = new AbortController(),\n      {\n        signal: t\n      } = n;\n    return (async u => {\n      const f = await h?.ach({\n        redirectURI: v,\n        transactionId: g\n      }).then(i => {\n        if (!u?.aborted) return z(i), i;\n      });\n      u.aborted ? (f?.removeEventListener(\"ontokenization\", () => {}), await f?.destroy()) : f?.addEventListener(\"ontokenization\", async i => {\n        const {\n          tokenResult: y,\n          error: L\n        } = i.detail;\n        L || y?.status == \"OK\" && (await p(y));\n      });\n    })(t), () => {\n      n.abort();\n    };\n  }, [o, h]), l) for (const n of Object.keys(l)) r?.addEventListener(H(n), l[n]);\n  S({\n    listener: A,\n    type: \"click\",\n    element: c,\n    options: {\n      passive: !0\n    }\n  });\n  const {\n      isLoading: x,\n      ...w\n    } = R ?? {},\n    a = x || !r || C;\n  return d ? /* @__PURE__ */e.createElement(E, {\n    ...w,\n    \"aria-disabled\": a,\n    disabled: a,\n    ref: c,\n    type: \"button\"\n  }, d) : /* @__PURE__ */e.createElement(E, {\n    ...w,\n    \"aria-disabled\": a,\n    disabled: a,\n    ref: c,\n    type: \"button\"\n  }, /* @__PURE__ */e.createElement(_, {\n    fill: \"none\",\n    height: \"1em\",\n    viewBox: \"0 0 36 24\",\n    width: \"1em\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ...k\n  }, /* @__PURE__ */e.createElement(\"rect\", {\n    fill: \"url(#prefix__paint0_linear)\",\n    height: 24,\n    rx: 4,\n    width: 36\n  }), /* @__PURE__ */e.createElement(\"path\", {\n    clipRule: \"evenodd\",\n    d: \"M18.509 6.16a.89.89 0 00-1.018 0l-6.124 4.285a.848.848 0 00-.325.96.873.873 0 00.833.595h1.75v4.286h-1.75a.866.866 0 00-.875.857c0 .473.392.857.875.857h12.25a.866.866 0 00.875-.857.866.866 0 00-.875-.857h-1.75V12h1.75c.38 0 .717-.24.833-.596a.848.848 0 00-.324-.959L18.509 6.16zm2.116 10.126V12h-5.25v4.286h5.25zM18 7.91l3.395 2.376h-6.79L18 7.91z\",\n    fill: \"#fff\",\n    fillRule: \"evenodd\"\n  }), /* @__PURE__ */e.createElement(\"defs\", null, /* @__PURE__ */e.createElement(\"linearGradient\", {\n    gradientUnits: \"userSpaceOnUse\",\n    id: \"prefix__paint0_linear\",\n    x1: 36,\n    x2: 0,\n    y1: 12,\n    y2: 12\n  }, /* @__PURE__ */e.createElement(\"stop\", {\n    stopColor: \"#01D09E\"\n  }), /* @__PURE__ */e.createElement(\"stop\", {\n    offset: 1,\n    stopColor: \"#03E4AE\"\n  })))), /* @__PURE__ */e.createElement(\"span\", null, \"Pay with Direct debit (ACH)\"));\n}\nexport { G as Ach, G as default };","map":{"version":3,"names":["G","accountHolderName","b","redirectURI","v","transactionId","g","callbacks","l","buttonProps","R","children","d","svgProps","k","r","z","e","useState","C","m","cardTokenizeResponseReceived","p","createPaymentRequest","o","payments","h","P","c","useRef","A","n","stopPropagation","console","warn","Error","t","tokenize","intent","amount","total","currency","currencyCode","status","s","errors","JSON","stringify","error","useEffect","AbortController","signal","u","f","ach","then","i","aborted","removeEventListener","destroy","addEventListener","tokenResult","y","L","detail","abort","Object","keys","H","S","listener","type","element","options","passive","isLoading","x","w","a","createElement","E","disabled","ref","_","fill","height","viewBox","width","xmlns","rx","clipRule","fillRule","gradientUnits","id","x1","x2","y1","y2","stopColor","offset"],"sources":["/Users/davorins/Desktop/bs/node_modules/react-square-web-payments-sdk/src/components/ach/ach.tsx"],"sourcesContent":["// Dependencies\nimport * as React from 'react';\nimport type * as Square from '@square/web-sdk';\n\n// Internals\nimport { useForm } from '~/contexts/form';\nimport { useEventListener } from '~/hooks/use-event-listener';\nimport { PayButton, SvgIcon } from './ach.styles';\nimport { transformPlaidEventName } from './ach.utils';\nimport type { AchProps, } from './ach.types';\n\n/**\n * Renders a ACH button to use in the Square Web Payment SDK, pre-styled to meet\n * Square branding guidelines.\n *\n * **_But with the option to override styles or use a custom children_**\n *\n * @example\n *\n * ```tsx\n * function App() {\n *   return (\n *     <SquareForm {...props}>\n *       <Ach />\n *     </SquareForm>\n *   );\n * }\n * ```\n */\nexport function Ach({\n  accountHolderName,\n  redirectURI,\n  transactionId,\n  callbacks,\n  buttonProps,\n  children,\n  svgProps,\n}: AchProps) {\n  const [ach, setAch] = React.useState<Square.ACH | undefined>(() => undefined);\n  const [isSubmitting, setIsSubmitting] = React.useState<boolean>(false);\n  const { cardTokenizeResponseReceived, createPaymentRequest, payments } = useForm();\n  const buttonRef = React.useRef<HTMLButtonElement>(null);\n\n  /**\n   * Handle the on click of the ACH button click\n   *\n   * @param e An event which takes place in the DOM.\n   * @returns The data be sended to `cardTokenizeResponseReceived()` function, or an error\n   */\n  const handlePayment = async (e: Event) => {\n    e.stopPropagation();\n\n    if (!ach) {\n      console.warn('ACH button was clicked, but no ACH instance was found.');\n      return;\n    }\n\n    if (!createPaymentRequest) throw new Error('`createPaymentRequest()` is required when using ACH payments');\n\n    setIsSubmitting(true);\n\n    try {\n      const result = await ach.tokenize({\n        accountHolderName,\n        intent: 'CHARGE',\n        amount: createPaymentRequest.total.amount,\n        currency: createPaymentRequest.currencyCode,\n      });\n\n      if (result?.status === 'OK') {\n        const tokenizedResult = await cardTokenizeResponseReceived(result);\n        return tokenizedResult;\n      }\n\n      let message = `Tokenization failed with status: ${result?.status ?? ''}`;\n      if (result?.errors) {\n        message += ` and errors: ${JSON.stringify(result?.errors)}`;\n        throw new Error(message);\n      }\n\n      console.warn(message);\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  React.useEffect(() => {\n    const abortController = new AbortController();\n    const { signal } = abortController;\n\n    const start = async (signal: AbortSignal) => {\n      const ach = await payments\n        ?.ach({\n          redirectURI,\n          transactionId,\n        })\n        .then((res) => {\n          if (signal?.aborted) return;\n          setAch(res);\n          return res;\n        });\n\n      if (signal.aborted) {\n        ach?.removeEventListener('ontokenization' as Square.PlaidEventName, () => { })\n        await ach?.destroy();\n      } else {\n        ach?.addEventListener(\n          'ontokenization' as Square.PlaidEventName,\n          async (result: Square.SqEvent<Square.TokenizationEvent>) => {\n            const { tokenResult, error } = result.detail;\n            if (error) {\n              // add code here to handle error\n            } else if (tokenResult?.status == 'OK') {\n              await cardTokenizeResponseReceived(tokenResult);\n            }\n          }\n        )\n      }\n    };\n\n    start(signal);\n\n    return () => {\n      abortController.abort();\n    };\n  }, [createPaymentRequest, payments]);\n\n  if (callbacks) {\n    for (const callback of Object.keys(callbacks)) {\n      ach?.addEventListener(\n        transformPlaidEventName(callback),\n        (callbacks as Record<string, (event: Square.SqEvent<Square.TokenizationEvent>) => void>)[callback]\n      );\n    }\n  }\n\n\n  useEventListener({\n    listener: handlePayment,\n    type: 'click',\n    element: buttonRef,\n    options: {\n      passive: true,\n    },\n  });\n\n  const { isLoading, ...props } = buttonProps ?? {};\n  const disabled = isLoading || !ach || isSubmitting;\n\n  if (children) {\n    return (\n      <PayButton {...props} aria-disabled={disabled} disabled={disabled} ref={buttonRef} type=\"button\">\n        {children}\n      </PayButton>\n    );\n  }\n\n  return (\n    <PayButton {...props} aria-disabled={disabled} disabled={disabled} ref={buttonRef} type=\"button\">\n      <SvgIcon\n        fill=\"none\"\n        height=\"1em\"\n        viewBox=\"0 0 36 24\"\n        width=\"1em\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        {...svgProps}\n      >\n        <rect fill=\"url(#prefix__paint0_linear)\" height={24} rx={4} width={36} />\n        <path\n          clipRule=\"evenodd\"\n          d=\"M18.509 6.16a.89.89 0 00-1.018 0l-6.124 4.285a.848.848 0 00-.325.96.873.873 0 00.833.595h1.75v4.286h-1.75a.866.866 0 00-.875.857c0 .473.392.857.875.857h12.25a.866.866 0 00.875-.857.866.866 0 00-.875-.857h-1.75V12h1.75c.38 0 .717-.24.833-.596a.848.848 0 00-.324-.959L18.509 6.16zm2.116 10.126V12h-5.25v4.286h5.25zM18 7.91l3.395 2.376h-6.79L18 7.91z\"\n          fill=\"#fff\"\n          fillRule=\"evenodd\"\n        />\n        <defs>\n          <linearGradient gradientUnits=\"userSpaceOnUse\" id=\"prefix__paint0_linear\" x1={36} x2={0} y1={12} y2={12}>\n            <stop stopColor=\"#01D09E\" />\n            <stop offset={1} stopColor=\"#03E4AE\" />\n          </linearGradient>\n        </defs>\n      </SvgIcon>\n      <span>Pay with Direct debit (ACH)</span>\n    </PayButton>\n  );\n}\n\nexport default Ach;\nexport * from './ach.types';\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}